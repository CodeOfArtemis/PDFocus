# Системные паттерны

## Архитектурные паттерны
- **Django MVT** (Model-View-Template) с AJAX-расширениями
- **Компонентный подход** к UI с модульными JavaScript функциями
- **Модульная структура CSS** с переиспользуемыми классами
- **AJAX-first подход** для всех пользовательских операций

## Технические решения

### 1. **Обработка PDF**
- **PDF.js интеграция**: Модульный импорт для клиентского рендеринга
- **Извлечение текста по страницам**: Модель `PDFPageText` для детального анализа
- **Автоматическое извлечение метаданных**: Ключевые слова через `yake`
- **Синхронизация viewer-текст**: Отображение текста текущей страницы

### 2. **AJAX-архитектура**
- **Унифицированные заголовки**: `X-Requested-With: XMLHttpRequest`
- **Стандартизированные JSON-ответы**: Паттерн `{success: boolean, data/error}`
- **CSRF-защита**: Автоматическое включение токенов во все запросы
- **Graceful degradation**: Fallback на стандартные HTTP-запросы

### 3. **JavaScript модульность**
- **Паттерн инициализации**: `initDetailPagePdf()`, `initDetailNoteForm()`, etc.
- **Разделение ответственности**: Отдельные функции для каждой страницы
- **Централизованные утилиты**: `showSuccessMessage()`, `updatePageText()`
- **Event delegation**: Динамическое добавление обработчиков

## Паттерны UI

### 1. **Двухколоночные макеты**
- **CSS Grid**: `grid-template-columns: 1fr 1fr` для детальной страницы
- **Flexbox внутри**: Для вертикального распределения контента
- **Responsive breakpoints**: Адаптация под мобильные устройства

### 2. **Карточки документов**
- **Фиксированная высота** в каталоге для единообразия
- **Компактный вид** в личном кабинете с двухколоночным grid
- **Flex-layout** для прижимания кнопок к низу
- **Ellipsis truncation** для длинных текстов

### 3. **Интерактивные компоненты**
- **PDF viewer controls**: Унифицированные кнопки навигации
- **Note management**: Красные кнопки удаления с hover-эффектами
- **Form controls**: AJAX-отправка с предотвращением reload
- **Notification system**: Временные всплывающие уведомления

## Модели данных

### **Основные модели**
```python
PDFDocument  # Основная информация о файле
Note        # Заметки пользователей к документам  
PDFPageText # Текст по страницам для синхронизации
```

### **Связи**
- `User → PDFDocument` (1:M) - владение документами
- `User → Note` (1:M) - авторство заметок
- `PDFDocument → Note` (1:M) - заметки к документу
- `PDFDocument → PDFPageText` (1:M) - текст по страницам

## Безопасность

### **Паттерны авторизации**
- **Проверка владельца**: `get_object_or_404(Model, user=request.user)`
- **AJAX CSRF**: Автоматическое включение токенов
- **Валидация форм**: Server-side проверка всех данных
- **Session-based auth**: Стандартная Django аутентификация

## Обработка ошибок

### **Client-side**
- **Подробное логирование**: Console.log для отладки
- **User-friendly сообщения**: Alert'ы и уведомления на русском
- **Graceful degradation**: Fallback для неподдерживаемых браузеров

### **Server-side**
- **Try-catch блоки**: Обработка исключений в критических функциях
- **JSON error responses**: Структурированные ответы об ошибках
- **Logging**: Print-отладка для развития (TODO: proper logging)

## Взаимодействие компонентов
- **Единая система стилей**: CSS переменные для консистентности
- **Модульный JavaScript**: Независимые функции без глобальных конфликтов
- **AJAX-first UX**: Минимизация перезагрузок страниц
- **Progressive enhancement**: Базовая функциональность без JavaScript 