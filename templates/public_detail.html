{% extends "base.html" %}

{% block content %}
<div class="card">
    <div class="detail-header">
        <h2>{{ pdf.title }}</h2>
        <div class="public-badge">
            <span class="badge badge-public">–ü—É–±–ª–∏—á–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç</span>
        </div>
    </div>

    <div class="pdf-meta-info">
        <div class="meta-row">
            <strong>–ê–≤—Ç–æ—Ä:</strong> {{ pdf.authors }}
        </div>
        <div class="meta-row">
            <strong>–¢–∏–ø:</strong> {{ pdf.get_doc_type_display }}
        </div>
        {% if pdf.theme %}
        <div class="meta-row">
            <strong>–¢–µ–º–∞:</strong> {{ pdf.theme }}
        </div>
        {% endif %}
        {% if pdf.keywords %}
        <div class="meta-row">
            <strong>–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞:</strong> {{ pdf.keywords }}
        </div>
        {% endif %}
        <div class="meta-row">
            <strong>–î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:</strong> {{ pdf.upload_date|date:"d.m.Y H:i" }}
        </div>
    </div>

    <div class="document-actions-public">
        <a href="{% url 'catalog' %}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–∞–ª–æ–≥—É</a>
        <a href="{{ pdf.file.url }}" class="btn btn-primary" download>–°–∫–∞—á–∞—Ç—å PDF</a>
    </div>

    <div class="pdf-view-container">
        <div class="pdf-viewer-section">
            <h3>–ü—Ä–æ—Å–º–æ—Ç—Ä PDF:</h3>
            <div class="pdf-viewer-wrapper">
                <div id="pdf-viewer-detail">
                    <div class="pdf-placeholder" id="pdf-placeholder-detail">
                        <i>üìÑ</i>
                        <p>–ó–∞–≥—Ä—É–∑–∫–∞ PDF...</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="extracted-text-section">
            <h3>–ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:</h3>
            <textarea readonly style="width: 100%; height: 500px">{{ pdf.extracted_text }}</textarea>
        </div>
    </div>

    <div class="pdf-controls-detail" id="pdf-controls-detail">
        <div class="pdf-nav-buttons">
            <button id="prev-page-detail" class="btn btn-secondary">–ü—Ä–µ–¥—ã–¥—É—â–∞—è</button>
            <span id="page-num-detail">–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1 –∏–∑ 1</span>
            <button id="next-page-detail" class="btn btn-secondary">–°–ª–µ–¥—É—é—â–∞—è</button>
        </div>
    </div>

    <div class="readonly-notice">
        <p><i>‚ÑπÔ∏è</i> –≠—Ç–æ –ø—É–±–ª–∏—á–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç. –í—ã –º–æ–∂–µ—Ç–µ —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏ —Å–∫–∞—á–∏–≤–∞—Ç—å –µ–≥–æ.</p>
    </div>
</div>

{{ page_texts|json_script:"page-texts-data" }}
<input type="hidden" id="pdf-file-url" value="{{ pdf.file.url }}">
<input type="hidden" name="document_id" value="{{ pdf.id }}">

<script>
// –ü–µ—Ä–µ–¥–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ —Ç–µ–∫—Å—Ç–µ –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º –≤ JavaScript
const pageTextsElement = document.getElementById('page-texts-data');
window.pageTexts = pageTextsElement ? JSON.parse(pageTextsElement.textContent) : {};

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è PDF viewer –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
document.addEventListener('DOMContentLoaded', function() {
    // –ñ–¥–µ–º –∫–æ–≥–¥–∞ app.js –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –∏ —Å–¥–µ–ª–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –¥–æ—Å—Ç—É–ø–Ω–æ–π
    function waitForInit() {
        if (typeof window.initDetailPagePdf === 'function') {
            window.initDetailPagePdf();
        } else {
            // –ü–æ–≤—Ç–æ—Ä—è–µ–º –ø–æ–ø—ã—Ç–∫—É —á–µ—Ä–µ–∑ 100–º—Å
            setTimeout(waitForInit, 100);
        }
    }
    waitForInit();
});
</script>
{% endblock %} 