{% extends "base.html" %}

{% block content %}
<div class="card">
    <a href="{% url 'catalog' %}" class="btn btn-secondary back-to-catalog-btn">Назад к каталогу</a>
    <div class="detail-header">
        <h2>{{ pdf.title }}</h2>
    </div>

    <form method="post" class="pdf-meta-form">
        {% csrf_token %}
        <div class="form-group">
            <label><strong>Автор:</strong></label>
            <input type="text" name="authors" value="{{ pdf.authors }}" class="editable-field">
        </div>

        <div class="form-group">
            <label><strong>Тип:</strong></label>
            <select name="doc_type" class="editable-field">
                <option value="Книга" {% if pdf.doc_type == "Книга" %}selected{% endif %}>Книга</option>
                <option value="Статья" {% if pdf.doc_type == "Статья" %}selected{% endif %}>Статья</option>
                <option value="Отчет" {% if pdf.doc_type == "Отчет" %}selected{% endif %}>Отчет</option>
                <option value="Другое" {% if pdf.doc_type == "Другое" %}selected{% endif %}>Другое</option>
            </select>
        </div>

        <div class="form-group">
            <label><strong>Тема:</strong></label>
            <input type="text" name="theme" value="{{ pdf.theme }}" class="editable-field">
        </div>

        <div class="form-group">
            <label><strong>Ключевые слова:</strong></label>
            <input type="text" name="keywords" value="{{ pdf.keywords }}" class="editable-field">
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-success">Сохранить изменения</button>
            <a href="{{ pdf.file.url }}" class="btn btn-primary" download>Скачать PDF</a>
            <button type="button" class="btn btn-primary">Опубликовать</button>
        </div>
    </form>

    <div class="extracted-text">
        <h3>Извлеченный текст:</h3>
        <textarea readonly style="width: 100%; height: 500px">{{ pdf.extracted_text }}</textarea>
    </div>

    <div class="notes-section">
        <h3>Заметки</h3>
        <form action="{% url 'save_note' %}" method="post" class="note-form">
            {% csrf_token %}
            <input type="hidden" name="document_id" value="{{ pdf.id }}">
            <div class="form-group">
                <label for="id_page_number">Номер страницы:</label>
                <input type="number" name="page_number" id="id_page_number" required min="1" class="page-number-input">
            </div>
            <div class="form-group">
                <label for="id_note_text">Текст заметки:</label>
                <textarea name="text" id="id_note_text" placeholder="Введите текст заметки..." required class="note-textarea"></textarea>
            </div>
            <div class="note-form-footer">
                <button type="submit" class="btn btn-primary">Добавить заметку</button>
            </div>
        </form>

        <div class="notes-list">
            {% for note in notes %}
            <div class="note-item">
                <p class="note-text">{{ note.text }}</p>
                <span class="note-meta">Стр. {{ note.page_number }} - {{ note.created_at|date:"d.m.Y H:i" }}</span>
            </div>
            {% empty %}
            <p>К этому документу пока нет заметок.</p>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}